<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2>Relatório de Chamados</h2>
          <p class="text-muted">Análise detalhada dos chamados de serviço</p>
        </div>
        <button class="btn btn-secondary" routerLink="/relatorios">
          <i class="fas fa-arrow-left me-1"></i>Voltar
        </button>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="row mb-4">
    <div class="col-12">
      <app-filtros-periodo (filtroChange)="onFiltroChange($event)"></app-filtros-periodo>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-3 text-muted">Carregando dados do relatório...</p>
  </div>

  <!-- Erro -->
  <div *ngIf="!loading && error" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
  </div>

  <!-- Estatísticas -->
  <div *ngIf="!loading && !error && dados" class="row mb-4">
    <div class="col-md-3">
      <div class="card stats-card text-center h-100">
        <div class="card-body">
          <i class="fas fa-ticket-alt fa-2x text-primary mb-3"></i>
          <h3 class="text-primary fw-bold">{{ dados.estatisticas.totalChamados }}</h3>
          <p class="card-text text-muted mb-0">Total de Chamados</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stats-card warning text-center h-100">
        <div class="card-body">
          <i class="fas fa-clock fa-2x text-warning mb-3"></i>
          <h3 class="text-warning fw-bold">{{ dados.estatisticas.chamadosEmAndamento }}</h3>
          <p class="card-text text-muted mb-0">Em Andamento</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stats-card success text-center h-100">
        <div class="card-body">
          <i class="fas fa-check-circle fa-2x text-success mb-3"></i>
          <h3 class="text-success fw-bold">{{ dados.estatisticas.chamadosFechados }}</h3>
          <p class="card-text text-muted mb-0">Concluídos</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stats-card info text-center h-100">
        <div class="card-body">
          <i class="fas fa-hourglass-half fa-2x text-info mb-3"></i>
          <h3 class="text-info fw-bold">{{ (dados && dados.estatisticas.tempoMedioAtendimento) || '-' }}</h3>
          <p class="card-text text-muted mb-0">Tempo Médio</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Análises por Categoria -->
  <div *ngIf="!loading && !error && dados" class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Chamados por Prioridade</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Prioridade</th>
                  <th>Quantidade</th>
                  <th>Percentual</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of chamadosPorPrioridadeArray">
                  <td>
                    <span class="badge" 
                          [ngClass]="{
                            'bg-danger': item.prioridade === 'Alta',
                            'bg-warning': item.prioridade === 'Média',
                            'bg-success': item.prioridade === 'Baixa'
                          }">
                      {{ item.prioridade }}
                    </span>
                  </td>
                  <td>{{ item.quantidade }}</td>
                  <td>{{ (item.quantidade / dados.estatisticas.totalChamados * 100).toFixed(1) }}%</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Chamados por Técnico</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Técnico</th>
                  <th>Quantidade</th>
                  <th>Percentual</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of chamadosPorTecnicoArray">
                  <td>{{ item.tecnico }}</td>
                  <td>{{ item.quantidade }}</td>
                  <td>{{ (item.quantidade / dados.estatisticas.totalChamados * 100).toFixed(1) }}%</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabela de Chamados -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Lista de Chamados</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Cliente</th>
                  <th>Descrição</th>
                  <th>Status</th>
                  <th>Técnico</th>
                  <th>Data Abertura</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let chamado of dados?.chamados">
                  <td>#{{ chamado.id }}</td>
                  <td>{{ chamado.cliente }}</td>
                  <td>{{ chamado.titulo }}</td>
                  <td>
                    <span class="badge" 
                          [ngClass]="{
                            'bg-success': chamado.status === 'Concluído' || chamado.status === 'Fechado',
                            'bg-warning': chamado.status === 'Em Andamento',
                            'bg-primary': chamado.status === 'Aberto',
                            'bg-danger': chamado.status === 'Cancelado'
                          }">
                      {{ chamado.status }}
                    </span>
                  </td>
                  <td>{{ chamado.tecnico || '-' }}</td>
                  <td>{{ chamado.dataAbertura | date:'dd/MM/yyyy' }}</td>
                  <td>
                    <button class="btn btn-sm btn-outline-primary" 
                            title="Ver detalhes do chamado">
                      <i class="fas fa-eye"></i>
                    </button>
                  </td>
                </tr>
                <tr *ngIf="dados?.chamados?.length === 0">
                  <td colspan="7" class="text-center text-muted">Nenhum chamado encontrado no período selecionado</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
